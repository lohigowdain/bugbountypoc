<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Hunters - Security Vulnerability Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=6LcwUaoqAAAAAKripfytin08sXbLKHz0PpjzjoKN"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">Bug Hunters Platform</h1>
        <div id="securityBugReport"></div>
    </div>

    <script>
        const RECAPTCHA_SITE_KEY = '6LcwUaoqAAAAAKripfytin08sXbLKHz0PpjzjoKN';
        const API_ENDPOINT = 'https://r81g4et74f.execute-api.us-east-1.amazonaws.com/prod/bug-report';

        async function loadBugReportForm() {
            try {
                const token = await new Promise((resolve, reject) => {
                    grecaptcha.ready(() => {
                        grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'load_form'})
                            .then(resolve)
                            .catch(reject);
                    });
                });
                
                const response = await fetch(API_ENDPOINT, {
                    method: 'GET',
                    headers: {
                        'x-recaptcha-token': token
                    },
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error('Failed to load form');
                }

                const html = await response.text();
                document.getElementById('securityBugReport').innerHTML = html;

                // Add form submission handler
                const form = document.getElementById('bugReportForm');
                if (form) {
                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const submitToken = await new Promise((resolve) => {
                            grecaptcha.ready(() => {
                                grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'submit_form'})
                                    .then(resolve);
                            });
                        });

                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData);

                        try {
                            const submitResponse = await fetch(API_ENDPOINT, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'x-recaptcha-token': submitToken
                                },
                                mode: 'cors',
                                body: JSON.stringify(data)
                            });

                            if (!submitResponse.ok) {
                                throw new Error('Submission failed');
                            }

                            alert('Report submitted successfully!');
                            form.reset();
                        } catch (error) {
                            console.error('Submission error:', error);
                            alert('Failed to submit report. Please try again.');
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading form:', error);
                document.getElementById('securityBugReport').innerHTML = 
                    '<div class="text-red-600 text-center">Failed to load the security report form. Please try again later.</div>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadBugReportForm);
    </script>
</body>
</html> 
